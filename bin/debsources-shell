#!/usr/bin/env python
# TODO all app related stuff should be integrated into a single file.
# e.g., debsources-app-manage.py
from pprint import pprint

from flask.ext.script import Manager

from debsources.app import app_wrapper

# less typing
app = app_wrapper.app

# it's ugly though, but we do want a port different from the running one.
def _create_app():
    settings = dict(
            DEBUG=True,
            PORT=6000,
            )
    app.config.update(settings)
    return app


manager = Manager(_create_app)


@manager.shell
def make_shell_context():

    def list_rules():
        for rule in app.url_map.iter_rules():
            pprint(rule)


    # names here will appear in the global space in interactive shell
    return dict(
            app=app,
            wrapper=app_wrapper,
            list_rules=list_rules,
            sources=app.blueprints['sources']
            )


if __name__ == "__main__":
    manager.run()
